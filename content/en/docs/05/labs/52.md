---
title: "5.2 Tasks: Prometheus Operator"
weight: 5
sectionnumber: 5.2
onlyWhenNot: baloise
---

### Task {{% param sectionnumber %}}.1: Configure Prometheus storage

By default, the Prometheus operator stack does not persist the data of the deployed monitoring stack. Therefore, any pod restart would result in a reset of all data. Let's configure persistence for Prometheus.

**Task description**:

* See this [example](https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/user-guides/storage.md#manual-storage-provisioning) of how to configure storage for Prometheus
* Set the Prometheus volume size to `20Gi`

To get the current values, either look at the file in git or use `{{% param cliToolName %}} get`.

{{% details title="Hints" mode-switcher="normalexpertmode" %}}

Define the storage size for your Prometheis in the file, commit and push it.

```yaml
...
spec:
  ...
  storage:
    volumeClaimTemplate:
      spec:
        resources:
          requests:
            storage: 20Gi
  ...
```

```bash
{{% param cliToolName %}} get pvc -n <user>-monitoring
```

Check if the volume is available inside the pod with running `df -h /prometheus` inside the first Prometheus pod.

```bash
{{% param cliToolName %}} -n <user>-monitoring exec prometheus-k8s-0 -c prometheus -- df -h /prometheus
```

{{% /details %}}

### Task {{% param sectionnumber %}}.2: Configure Prometheus Retention

By default, the Prometheus operator stack will set the retention of your metrics to `24h`. As we have now 20Gi of disk space available, we can increase the retention.
Read about [retention operational-aspects](https://prometheus.io/docs/prometheus/latest/storage/#operational-aspects) for options to manage retention.

**Task description**:

* Set Prometheus retention time to two days and retention size to 9Gi

{{% alert title="Note" color="primary" %}}
Check [documentation](https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/api.md#prometheusspec) for available options
{{% /alert %}}

{{% details title="Hints" mode-switcher="normalexpertmode" %}}

Set the following options in the file, commit and push it.

```yaml
...
spec:
  ...
  retention: 2d
  retentionSize: 9GB
  ...
```

Verify that the pods are redeployed with `{{% param cliToolName %}} -n <user>-monitoring get pods` and that the retention parameter is set in the newly created pods.

```bash
{{% param cliToolName %}} -n <user>-monitoring describe pods prometheus-k8s-0
```

The output should contain the following lines:

```yaml
...
Containers:
  ...
  prometheus:
    ...
    Args:
      ...
      --storage.tsdb.retention.size=9GB
      --storage.tsdb.retention.time=2d
      ...
```

{{% /details %}}
